# 数据源配置优化说明

**日期**: 2026-02-03
**配置类型**: 按需获取实时行情，盘后同步历史数据

---

## 优化后的配置策略

### 实时行情获取
- **使用**: AKShare（东方财富/新浪财经接口）
- **时机**: 仅在分析股票时按需获取
- **禁用**: 所有定时实时行情同步任务

### 历史数据 & 财务数据
- **使用**: Tushare
- **时机**: 收盘后自动同步
- **启用**: 每日16点历史数据，每周日3点财务数据

---

## 关键配置变更

### 1. 禁用实时行情自动入库
```bash
QUOTES_INGEST_ENABLED=false
```

### 2. 禁用 Tushare 实时行情同步
```bash
TUSHARE_QUOTES_SYNC_ENABLED=false
```

### 3. 启用 AKShare 用于实时行情获取
```bash
AKSHARE_UNIFIED_ENABLED=true
```

### 4. 禁用 AKShare 所有定时同步任务
```bash
AKSHARE_BASIC_INFO_SYNC_ENABLED=false
AKSHARE_QUOTES_SYNC_ENABLED=false
AKSHARE_HISTORICAL_SYNC_ENABLED=false
AKSHARE_FINANCIAL_SYNC_ENABLED=false
AKSHARE_STATUS_CHECK_ENABLED=false
```

### 5. 保留 Tushare 盘后同步
```bash
TUSHARE_HISTORICAL_SYNC_ENABLED=true
TUSHARE_HISTORICAL_SYNC_CRON="0 16 * * 1-5"

TUSHARE_FINANCIAL_SYNC_ENABLED=true
TUSHARE_FINANCIAL_SYNC_CRON="0 3 * * 0"
```

---

## 预期效果

### 交易时段（9:30-15:30）
- ❌ 不进行任何自动数据同步
- ✅ 分析股票时按需获取实时行情（AKShare）

### 收盘后（16:00-17:00）
- ✅ Tushare 自动同步历史日线数据
- ✅ 入库后可用于次日的 AI 分析

### 周日（03:00）
- ✅ Tushare 自动同步财务数据
- ✅ 更新季报/年报等财务指标

---

## 避免的问题

1. **Tushare rt_k 限流** - 免费用户每分钟1次限制
2. **频繁采集资源浪费** - 按需获取更高效
3. **API 调用超限** - 减少不必要的定时任务

---

## 回滚方案

如需恢复实时行情自动入库：

```bash
# 恢复实时行情采集
QUOTES_INGEST_ENABLED=true
QUOTES_INGEST_INTERVAL_SECONDS=3600

# 或恢复 Tushare 实时同步
TUSHARE_QUOTES_SYNC_ENABLED=true
```

---

## 验证方法

检查日志确认配置生效：

```bash
# 启动应用，观察日志
docker-compose up -d

# 应该看到：
# ✅ Tushare 数据源已启用
# ✅ AKShare 数据源已启用
# ⏸️ BaoStock 数据源已禁用
# ⏸️ AKShare 基础信息同步已暂停
# ⏸️ AKShare 实时行情同步已暂停
# ...
```

---

*Generated by Claude Code*
