# å®æ—¶è¡Œæƒ…åŠŸèƒ½å¿«é€Ÿå…¥é—¨

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

**ç›˜ä¸­åˆ†æè‡ªåŠ¨ä½¿ç”¨å®æ—¶ä»·æ ¼** - æ— éœ€ä»»ä½•ä»£ç ä¿®æ”¹ï¼

ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºäº¤æ˜“æ—¶é—´ï¼š
- âœ… **ç›˜ä¸­** â†’ è‡ªåŠ¨ä½¿ç”¨å®æ—¶è¡Œæƒ…ï¼ˆä»·æ ¼å»¶è¿Ÿ < 3ç§’ï¼‰
- âœ… **ç›˜å** â†’ è‡ªåŠ¨ä½¿ç”¨å†å²æ•°æ®ï¼ˆæ”¶ç›˜ä»·ï¼‰
- âœ… **å‘¨æœ«/èŠ‚å‡æ—¥** â†’ ä½¿ç”¨æœ€è¿‘äº¤æ˜“æ—¥æ•°æ®

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### 1. ç›´æ¥ä½¿ç”¨ï¼ˆé›¶é…ç½®ï¼‰

```python
from tradingagents.graph.trading_graph import TradingAgentsGraph
from tradingagents.default_config import DEFAULT_CONFIG

# åˆå§‹åŒ–
ta = TradingAgentsGraph(debug=True, config=DEFAULT_CONFIG)

# æ‰§è¡Œåˆ†æ - ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­å¹¶ä½¿ç”¨å®æ—¶è¡Œæƒ…
_, decision = ta.propagate("600765", "2025-01-19")
print(decision)
```

**å°±è¿™ä¹ˆç®€å•ï¼** ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
- åˆ¤æ–­æ˜¯å¦æ˜¯äº¤æ˜“æ—¶é—´
- ç›˜ä¸­æ—¶è·å–å®æ—¶è¡Œæƒ…
- å°†å®æ—¶ä»·æ ¼æ•´åˆåˆ°åˆ†ææŠ¥å‘Šä¸­

### 2. æŸ¥çœ‹å¸‚åœºçŠ¶æ€

```python
from tradingagents.utils.market_time import MarketTimeUtils

# æ£€æŸ¥å½“å‰å¸‚åœºçŠ¶æ€
status = MarketTimeUtils.get_market_status("600765")

print(f"å¸‚åœºçŠ¶æ€: {status['status']}")  
print(f"æ˜¯å¦äº¤æ˜“ä¸­: {status['is_trading']}")
print(f"æ˜¯å¦ä½¿ç”¨å®æ—¶è¡Œæƒ…: {status['should_use_realtime']}")
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
å¸‚åœºçŠ¶æ€: ç›˜ä¸­-ä¸‹åˆäº¤æ˜“æ—¶æ®µ
æ˜¯å¦äº¤æ˜“ä¸­: True
æ˜¯å¦ä½¿ç”¨å®æ—¶è¡Œæƒ…: True
```

### 3. å•ç‹¬è·å–å®æ—¶è¡Œæƒ…

```python
from tradingagents.dataflows.data_source_manager import get_data_source_manager

manager = get_data_source_manager()

# è·å–å®æ—¶è¡Œæƒ…
quote = manager.get_realtime_quote("600765")

if quote:
    print(f"ğŸ’° å®æ—¶ä»·æ ¼: Â¥{quote['price']:.2f}")
    print(f"ğŸ“ˆ æ¶¨è·Œå¹…: {quote['change_pct']:+.2f}%")
    print(f"ğŸ• æ›´æ–°æ—¶é—´: {quote['date']} {quote['time']}")
```

## ğŸ“Š æŠ¥å‘Šå¯¹æ¯”

### ç›˜ä¸­åˆ†æï¼ˆä½¿ç”¨å®æ—¶è¡Œæƒ…ï¼‰

```markdown
ğŸ“Š ä¸­èˆªé‡æœº(600765) - æŠ€æœ¯åˆ†ææ•°æ®
æ•°æ®æœŸé—´: 2025-01-09 è‡³ 2025-01-19

âš¡ å®æ—¶è¡Œæƒ…ï¼ˆç›˜ä¸­ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° å®æ—¶ä»·æ ¼: Â¥19.15
ğŸ“ˆ æ¶¨è·Œ: -0.35 (-1.79%)
ğŸ“Š ä»Šå¼€: Â¥19.50  |  æœ€é«˜: Â¥19.80  |  æœ€ä½: Â¥19.00
ğŸ• æ›´æ–°æ—¶é—´: 2025-01-19 14:30:15
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æœ€æ–°æ•°æ®æ—¥æœŸ: 2025-01-19
æ•°æ®æ¡æ•°: 30æ¡ (å±•ç¤ºæœ€è¿‘5ä¸ªäº¤æ˜“æ—¥)

ğŸ“Š ç§»åŠ¨å¹³å‡çº¿ (MA):
   MA5:  Â¥19.86 (ä»·æ ¼åœ¨MA5ä¸‹æ–¹ â†“)
   ...
```

### ç›˜ååˆ†æï¼ˆä½¿ç”¨å†å²æ•°æ®ï¼‰

```markdown
ğŸ“Š ä¸­èˆªé‡æœº(600765) - æŠ€æœ¯åˆ†ææ•°æ®
æ•°æ®æœŸé—´: 2025-01-09 è‡³ 2025-01-19
æœ€æ–°æ•°æ®æ—¥æœŸ: 2025-01-19
æ•°æ®æ¡æ•°: 30æ¡ (å±•ç¤ºæœ€è¿‘5ä¸ªäº¤æ˜“æ—¥)

ğŸ’° æœ€æ–°ä»·æ ¼: Â¥19.15 (æ•°æ®æ—¥æœŸ: 2025-01-19)
ğŸ“ˆ æ¶¨è·Œé¢: -0.35 (-1.79%)

ğŸ“Š ç§»åŠ¨å¹³å‡çº¿ (MA):
   MA5:  Â¥19.86 (ä»·æ ¼åœ¨MA5ä¸‹æ–¹ â†“)
   ...
```

## ğŸ• äº¤æ˜“æ—¶é—´è¯´æ˜

### Aè‚¡ï¼ˆä¸­å›½å¤§é™†ï¼‰
```
ä¸Šåˆ: 09:30 - 11:30
ä¸‹åˆ: 13:00 - 15:00
æ—¶åŒº: Asia/Shanghai (UTC+8)
```

### æ¸¯è‚¡ï¼ˆé¦™æ¸¯ï¼‰
```
ä¸Šåˆ: 09:30 - 12:00
ä¸‹åˆ: 13:00 - 16:00
æ—¶åŒº: Asia/Hong_Kong (UTC+8)
```

### ç¾è‚¡ï¼ˆçº½çº¦ï¼‰
```
å¸¸è§„: 09:30 - 16:00 (EST/EDT)
ç›˜å‰: 04:00 - 09:30
ç›˜å: 16:00 - 20:00
æ—¶åŒº: America/New_York
```

## ğŸ’¡ æ™ºèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨æ•°æ®æºåˆ‡æ¢

```
ç›˜ä¸­ (09:30-15:00)
    â†“
[æ£€æŸ¥MongoDBç¼“å­˜]
    â†“ (å¦‚æœæ²¡æœ‰)
[è°ƒç”¨AKShareå®æ—¶æ¥å£]
    â†“
è¿”å›å®æ—¶è¡Œæƒ…ï¼ˆç¼“å­˜10ç§’ï¼‰
```

```
ç›˜å (15:00å)
    â†“
[ä½¿ç”¨å†å²æ•°æ®]
    â†“
è¿”å›æ”¶ç›˜ä»·ï¼ˆç¼“å­˜1å°æ—¶ï¼‰
```

### 2. æ™ºèƒ½ç¼“å­˜ç­–ç•¥

| æ—¶æ®µ | ç¼“å­˜æ—¶é•¿ | è¯´æ˜ |
|------|---------|------|
| ç›˜ä¸­ | 10ç§’ | ä¿è¯å®æ—¶æ€§ |
| ç›˜å | 1å°æ—¶ | å‡å°‘APIè°ƒç”¨ |
| å‘¨æœ« | 24å°æ—¶ | æ•°æ®ä¸ä¼šå˜åŒ– |

### 3. å¤šæ•°æ®æºé™çº§

```
MongoDBå®æ—¶ç¼“å­˜
    â†“ (å¤±è´¥)
AKShareå®æ—¶æ¥å£
    â†“ (å¤±è´¥)
Tushareå®æ—¶æ¥å£
    â†“ (å¤±è´¥)
å†å²æ•°æ®ï¼ˆæœ€è¿‘ä¸€ä¸ªäº¤æ˜“æ—¥ï¼‰
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### å¿«é€Ÿæµ‹è¯•

```bash
# æµ‹è¯•å®æ—¶è¡Œæƒ…åŠŸèƒ½
python scripts/test_realtime_quote.py

# æµ‹è¯•æ•°æ®æ—¥æœŸæ ‡æ³¨
python scripts/test_data_date_fix.py
```

### äº¤äº’å¼æµ‹è¯•

```python
from tradingagents.utils.market_time import MarketTimeUtils

# æµ‹è¯•å¤šä¸ªè‚¡ç¥¨
symbols = ["600765", "000001", "600036"]

for symbol in symbols:
    status = MarketTimeUtils.get_market_status(symbol)
    print(f"\n{symbol}:")
    print(f"  çŠ¶æ€: {status['status']}")
    print(f"  äº¤æ˜“ä¸­: {status['is_trading']}")
    print(f"  ä½¿ç”¨å®æ—¶: {status['should_use_realtime']}")
```

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°å®æ—¶è¡Œæƒ…ï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. å½“å‰æ˜¯å¦æ˜¯äº¤æ˜“æ—¶é—´ï¼Ÿè¿è¡Œ `test_realtime_quote.py` æŸ¥çœ‹
2. æ•°æ®æºæ˜¯å¦å¯ç”¨ï¼Ÿæ£€æŸ¥ MongoDB æˆ– AKShare é…ç½®
3. æŸ¥çœ‹æ—¥å¿—ï¼š`logs/tradingagents.log`

### Q2: å®æ—¶æ•°æ®å»¶è¿Ÿæœ‰å¤šä¹…ï¼Ÿ

**A:** 
- MongoDBç¼“å­˜ï¼š< 1ç§’ï¼ˆå¦‚æœå·²é…ç½®å®æ—¶æ›´æ–°ï¼‰
- AKShareï¼š1-3ç§’
- Tushareï¼šéœ€è¦é«˜çº§æƒé™

### Q3: å‘¨æœ«èƒ½çœ‹åˆ°å®æ—¶ä»·æ ¼å—ï¼Ÿ

**A:** ä¸èƒ½ã€‚å‘¨æœ«éäº¤æ˜“æ—¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨æœ€è¿‘ä¸€ä¸ªäº¤æ˜“æ—¥ï¼ˆå‘¨äº”ï¼‰çš„æ”¶ç›˜ä»·ã€‚

### Q4: å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨å†å²æ•°æ®ï¼Ÿ

**A:** å¯ä»¥ä¸´æ—¶ä¿®æ”¹ï¼š
```python
# ä¸´æ—¶ç¦ç”¨å®æ—¶è¡Œæƒ…ï¼ˆè°ƒè¯•ç”¨ï¼‰
import os
os.environ['DISABLE_REALTIME_QUOTE'] = '1'
```

### Q5: å®æ—¶è¡Œæƒ…æ”¯æŒå“ªäº›å¸‚åœºï¼Ÿ

**A:** 
- âœ… Aè‚¡ï¼ˆ600xxx, 000xxx, 300xxxç­‰ï¼‰
- âœ… æ¸¯è‚¡ï¼ˆ00700.HKç­‰ï¼‰
- âš ï¸ ç¾è‚¡ï¼ˆéœ€è¦é¢å¤–é…ç½®æ•°æ®æºï¼‰

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ç¼“å­˜æ—¶é•¿

```python
from tradingagents.utils.market_time import get_realtime_cache_timeout

# è·å–å½“å‰ç¼“å­˜æ—¶é•¿
timeout = get_realtime_cache_timeout("600765")
print(f"ç¼“å­˜æ—¶é•¿: {timeout}ç§’")

# è‡ªå®šä¹‰ï¼ˆéœ€ä¿®æ”¹æºç ï¼‰
# ç¼–è¾‘ market_time.py ä¸­çš„ get_realtime_cache_timeout å‡½æ•°
```

### æ·»åŠ è‡ªå®šä¹‰æ•°æ®æº

```python
# åœ¨ data_source_manager.py ä¸­æ·»åŠ æ–°æ–¹æ³•
def _get_custom_realtime_quote(self, symbol: str) -> Optional[Dict]:
    """ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®æºè·å–å®æ—¶è¡Œæƒ…"""
    # å®ç°ä½ çš„æ•°æ®æºé€»è¾‘
    pass
```

### ä¿®æ”¹äº¤æ˜“æ—¶é—´

```python
# ç¼–è¾‘ market_time.py
class MarketTimeUtils:
    # ä¿®æ”¹äº¤æ˜“æ—¶é—´å¸¸é‡
    A_STOCK_MORNING_START = time(9, 30)
    A_STOCK_AFTERNOON_END = time(15, 0)
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å¯ç”¨MongoDBç¼“å­˜

åœ¨ `market_quotes` é›†åˆä¸­å®šæ—¶æ›´æ–°å®æ—¶è¡Œæƒ…ï¼š

```python
# å®šæ—¶ä»»åŠ¡ç¤ºä¾‹ï¼ˆ5ç§’æ›´æ–°ä¸€æ¬¡ï¼‰
from apscheduler.schedulers.background import BackgroundScheduler

def update_realtime_quotes():
    # è·å–æ‰€æœ‰è‚¡ç¥¨çš„å®æ—¶è¡Œæƒ…å¹¶å­˜å…¥MongoDB
    pass

scheduler = BackgroundScheduler()
scheduler.add_job(update_realtime_quotes, 'interval', seconds=5)
scheduler.start()
```

### 2. æ‰¹é‡è·å–

```python
from tradingagents.dataflows.data_source_manager import get_data_source_manager

manager = get_data_source_manager()
symbols = ["600765", "000001", "600036"]

quotes = []
for symbol in symbols:
    quote = manager.get_realtime_quote(symbol)
    if quote:
        quotes.append(quote)

print(f"æˆåŠŸè·å– {len(quotes)} ä¸ªå®æ—¶è¡Œæƒ…")
```

### 3. å¼‚æ­¥è·å–

```python
import asyncio

async def get_quotes_async(symbols):
    tasks = []
    for symbol in symbols:
        task = asyncio.to_thread(manager.get_realtime_quote, symbol)
        tasks.append(task)
    
    return await asyncio.gather(*tasks)

# ä½¿ç”¨
symbols = ["600765", "000001", "600036"]
quotes = asyncio.run(get_quotes_async(symbols))
```

## ğŸ“ å­¦ä¹ èµ„æº

- [å®Œæ•´æ–‡æ¡£](./realtime_quote_feature.md) - è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£
- [æµ‹è¯•è„šæœ¬](../scripts/test_realtime_quote.py) - åŠŸèƒ½æµ‹è¯•ä»£ç 
- [æºç ](../tradingagents/utils/market_time.py) - æ ¸å¿ƒå®ç°

## ğŸ†˜ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹æ—¥å¿—**: `logs/tradingagents.log`
2. **è¿è¡Œæµ‹è¯•**: `python scripts/test_realtime_quote.py`
3. **æ£€æŸ¥çŠ¶æ€**: 
```python
from tradingagents.utils.market_time import MarketTimeUtils
status = MarketTimeUtils.get_market_status("600765")
print(status)
```
4. **æäº¤Issue**: åˆ°é¡¹ç›®GitHubä»“åº“

## âœ¨ æ ¸å¿ƒä¼˜åŠ¿

| ç‰¹æ€§ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| ğŸš€ é›¶é…ç½® | æ— éœ€ä¿®æ”¹ä»£ç ï¼Œè‡ªåŠ¨å¯ç”¨ | âœ… |
| âš¡ å®æ—¶æ€§ | ç›˜ä¸­å»¶è¿Ÿ<3ç§’ | âœ… |
| ğŸ”„ è‡ªåŠ¨åˆ‡æ¢ | æ™ºèƒ½åˆ¤æ–­äº¤æ˜“æ—¶é—´ | âœ… |
| ğŸ’¾ æ™ºèƒ½ç¼“å­˜ | æ ¹æ®æ—¶æ®µè°ƒæ•´ç¼“å­˜ | âœ… |
| ğŸŒ å¤šå¸‚åœº | æ”¯æŒAè‚¡/æ¸¯è‚¡/ç¾è‚¡ | âœ… |
| ğŸ›¡ï¸ å®¹é”™é™çº§ | å¤šæ•°æ®æºè‡ªåŠ¨åˆ‡æ¢ | âœ… |

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-01-19)

- âœ¨ æ–°å¢å®æ—¶è¡Œæƒ…åŠŸèƒ½
- âœ¨ è‡ªåŠ¨äº¤æ˜“æ—¶é—´åˆ¤æ–­
- âœ¨ æ™ºèƒ½æ•°æ®æºåˆ‡æ¢
- âœ¨ ç›˜ä¸­/ç›˜åå·®å¼‚åŒ–å±•ç¤º
- ğŸ”§ ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
- ğŸ“š å®Œå–„æ–‡æ¡£å’Œæµ‹è¯•

---

**å¼€å§‹ä½¿ç”¨**: æ— éœ€ä»»ä½•é…ç½®ï¼Œç›´æ¥è¿è¡Œä½ çš„åˆ†æä»£ç å³å¯ï¼ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ä¸€åˆ‡ã€‚

**é‡è¦æç¤º**: ç›˜ä¸­åˆ†ææ—¶ï¼ŒæŠ¥å‘Šä¼šæ˜ç¡®æ ‡æ³¨ "âš¡ å®æ—¶è¡Œæƒ…ï¼ˆç›˜ä¸­ï¼‰"ï¼Œç¡®ä¿ä½ çŸ¥é“ä½¿ç”¨çš„æ˜¯å®æ—¶ä»·æ ¼ã€‚

**æŠ€æœ¯æ”¯æŒ**: å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å®Œæ•´æ–‡æ¡£æˆ–è¿è¡Œæµ‹è¯•è„šæœ¬è¿›è¡Œè¯Šæ–­ã€‚